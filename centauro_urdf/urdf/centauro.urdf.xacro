<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="centauro">

<!-- This argument and property should be in the top level xacro and
will be propagated to all its downstream childs -->
<xacro:arg name="centauro_root" default="$(find centauro_urdf)" />  
<xacro:property name="ROOT" value="$(arg centauro_root)" />

<!-- setting use_abs_mesh_paths should be kept to false
for use with tools like RViz, which does not accept plain
abolute paths for mesh paths-->
<xacro:arg name="use_abs_mesh_paths" default="false" />  
<xacro:arg name="use_local_filesys_for_meshes" default="false" />  

<xacro:property name="USE_ABS_MESH_PATHS" value="$(arg use_abs_mesh_paths)" />
  <xacro:property name="USE_LOCAL_FILESYS_FOR_MESHES" value="$(arg use_local_filesys_for_meshes)" />

<xacro:if value="${USE_ABS_MESH_PATHS}">
    <xacro:if value="${USE_LOCAL_FILESYS_FOR_MESHES}">
    <xacro:property name="MESH_PATH" value="file://${ROOT}/meshes" />
    </xacro:if>
    <xacro:unless value="${USE_LOCAL_FILESYS_FOR_MESHES}">
    <xacro:property name="MESH_PATH" value="${ROOT}/meshes" />
    </xacro:unless>
</xacro:if>
<xacro:unless value="${USE_ABS_MESH_PATHS}">
    <xacro:property name="MESH_PATH" value="package://centauro_urdf/meshes" />
</xacro:unless>

<xacro:macro name="example_macro">
  <example_element message="${MESH_PATH}" />
</xacro:macro>

<!-- configuration -->
<xacro:arg name="config" default="${ROOT}/urdf/config/centauro.urdf.xacro"/>

<!-- ************ MODEL CONFIGURATION ************ -->
<xacro:include filename="$(arg config)"/>

<xacro:if value="${ADD_UPPER_BODY}">

  <xacro:if value="${ADD_D435I_BASE or ADD_T265_BASE or ADD_D435I_HEAD}">

    <xacro:arg name="realsense_gazebo_description_root" default="$(find realsense_gazebo_description)" /> 
    <xacro:property name="REALSENSE_GAZEBO_DESCRIPTION_ROOT" value="$(arg realsense_gazebo_description_root)" />

  </xacro:if>

  <xacro:if value="${ADD_VELODYNE}">

    <xacro:arg name="velodyne_description_root" default="$(find velodyne_description)" /> 
    <xacro:property name="VELODYNE_DESCRIPTION_ROOT" value="$(arg velodyne_description_root)" />

  </xacro:if>

</xacro:if>

<!-- here the properties from the config dare set -->
<xacro:if value="${END_EFFECTOR_LEFT == 'dagana' 
              or END_EFFECTOR_LEFT == 'dagana_fixed'
              or END_EFFECTOR_RIGHT == 'dagana' or
              END_EFFECTOR_RIGHT == 'dagana_fixed'}">
	
	<xacro:arg name="dagana_root" default="$(find dagana_urdf)" /> 
	<xacro:property name="DAGANA_ROOT" value="$(arg dagana_root)" />

</xacro:if>

<!-- ************ Pholus plain model ************ -->
<xacro:include filename="${ROOT}/urdf/centauro_base.urdf.xacro"/>

<!-- ************ Control frames ************ -->


<xacro:if value="${ADD_FLOATING_BASE}">
<xacro:if value="${ADD_LEGS}">

<link name="world"/>

  <joint name="reference" type="floating">
    <parent link="world"/>
    <child link="base_link"/>
</joint>

</xacro:if>
</xacro:if>


<xacro:if value="${ADD_VIRTUAL_FRAME}">
  <xacro:include filename="${ROOT}/urdf/parts/virtual_frame.urdf.xacro"/>
</xacro:if>

</robot>
