<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

<!-- mirror_link = -1 for left side, otherwise mirror_link = 1 -->
<xacro:macro name="leg" params="prefix x y z mirror_link">

<!-- LINKS -->
<link name="${prefix}_hip_yaw">
<inertial>
	<mass value="${2.3314496}"/>
	<origin xyz="${1.3809158e-02*mmTom} ${-3.6754649e+01*mmTom*mirror_link} ${-5.7843523e+01*mmTom}" rpy="0.0 0.0 0.0"/>      
	<inertia ixx="${5.6852308e+03*mm2Tom2}"  ixy="${7.1047569e+00*mm2Tom2*mirror_link}"  ixz="${8.0684166e+00*mm2Tom2}" iyy="${2.7052853e+03*mm2Tom2}" iyz="${-2.7758320e+02*mm2Tom2*mirror_link}" izz="${5.4543143e+03*mm2Tom2}" />
</inertial>

<visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="black"/>
      <geometry name="${prefix}_hip_yaw_visual">
        <mesh filename="package://pholus_urdf/meshes/hip_yaw_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>
</visual> 

<collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry name="${prefix}_hip_yaw_collision">
        <mesh filename="package://pholus_urdf/meshes/simple/hip_yaw_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>             
</collision>  
</link>

<link name="${prefix}_hip_pitch">
<inertial>
	<mass value="${3.7152283}"/>
	<origin xyz="${1.4418193e-02*mmTom} ${3.2668329e+01*mmTom*mirror_link} ${-2.1994403e+02*mmTom}" rpy="0.0 0.0 0.0"/>      
	<inertia ixx="${5.4279504e+04*mm2Tom2}"  ixy="${-6.5556111e+00*mm2Tom2*mirror_link}"  ixz="${3.1960920e+00*mm2Tom2}" iyy="${5.2575988e+04*mm2Tom2}" iyz="${5.9623651e+03*mm2Tom2*mirror_link}" izz="${8.8535144e+03*mm2Tom2}" />
</inertial>

<visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="dark"/>
      <geometry name="${prefix}_hip_pitch_visual">
        <mesh filename="package://pholus_urdf/meshes/hip_pitch_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>
</visual> 

<collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry name="${prefix}_hip_pitch_collision">
        <mesh filename="package://pholus_urdf/meshes/simple/hip_pitch_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>             
</collision>  
</link>

<xacro:if value="${USE_STICKS}">
<link name="${prefix}_stick">
<inertial> 
	<mass value="${1.1927236}"/>
	<origin xyz="${1.4549221e+01*mmTom} ${-2.0785942e+01*mmTom*mirror_link} ${-1.9572282e+02*mmTom}" rpy="0.0 0.0 0.0"/>      
	<inertia ixx="${3.5313402e+04*mm2Tom2}"  ixy="${0.0*mm2Tom2*mirror_link}"  ixz="${1.1029574e-01*mm2Tom2}" iyy="${3.5530025e+04*mm2Tom2}" iyz="${-6.0307457e+02*mm2Tom2*mirror_link}" izz="${1.3302597e+03*mm2Tom2}" />
</inertial>

<visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="black"/>
      <geometry name="${prefix}_stick_visual">
        <mesh filename="package://pholus_urdf/meshes/front_right_stick.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>
</visual> 

<collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry name="${prefix}_stick_collision">
        <mesh filename="package://pholus_urdf/meshes/simple/front_right_stick.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>             
</collision>  
</link>
</xacro:if>

<xacro:unless value="${USE_STICKS}">
<link name="${prefix}_knee">
<inertial>
	<mass value="${2.311}"/>
	<origin xyz="${1.447e-01*mmTom} ${-2.483e+01*mmTom*mirror_link} ${-1.47e+02*mmTom}" rpy="0.0 0.0 0.0"/>      
	<inertia ixx="${1.855e+04*mm2Tom2}"  ixy="${3.206e+01*mm2Tom2*mirror_link}"  ixz="${1.817e+01*mm2Tom2}" iyy="${1.733e+04*mm2Tom2}" iyz="${-2.019e+03*mm2Tom2*mirror_link}" izz="${4.768e+03*mm2Tom2}" />
</inertial>

<visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="black"/>
      <geometry name="${prefix}_knee_visual">
        <mesh filename="package://pholus_urdf/meshes/knee_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>
</visual> 

<collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry name="${prefix}_knee_collision">
        <mesh filename="package://pholus_urdf/meshes/simple/knee_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>             
</collision>  
</link>

<link name="${prefix}_ankle_pitch">
<inertial> 
	<mass value="${1.6726027}"/>
	<origin xyz="${8.6047400e-02*mmTom} ${-5.8681540*mmTom*mirror_link} ${-6.6131770e+01*mmTom}" rpy="0.0 0.0 0.0"/>      
	<inertia ixx="${6.3822379e+03*mm2Tom2}"  ixy="${3.9583637e+00*mm2Tom2*mirror_link}"  ixz="${9.7063683e+00*mm2Tom2}" iyy="${6.2965213e+03*mm2Tom2}" iyz="${5.1140374e+02*mm2Tom2*mirror_link}" izz="${2.1644706e+03*mm2Tom2}" />
</inertial>

<visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="black"/>
      <geometry name="${prefix}_ankle_pitch_visual">
        <mesh filename="package://pholus_urdf/meshes/ankle_pitch_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>
</visual> 

<collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry name="${prefix}_ankle_pitch_collision">
        <mesh filename="package://pholus_urdf/meshes/simple/ankle_pitch_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>             
</collision>  
</link>


<link name="${prefix}_ankle_yaw">
<inertial>
	<mass value="${2.3213910}"/>
	<origin xyz="${1.7306023e-01*mmTom} ${-4.1556033*mmTom*mirror_link} ${-7.3402698e+01*mmTom}" rpy="0.0 0.0 0.0"/>      
	<inertia ixx="${1.2818913e+04*mm2Tom2}"  ixy="${-1.1031660e+01*mm2Tom2*mirror_link}"  ixz="${-2.7189069e+01*mm2Tom2}" iyy="${1.0091179e+04*mm2Tom2}" iyz="${-4.4018098e+02*mm2Tom2*mirror_link}" izz="${7.1470090e+03*mm2Tom2}" />
</inertial>

<visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <material name="black"/>
      <geometry name="${prefix}_ankle_yaw_visual">
        <mesh filename="package://pholus_urdf/meshes/ankle_yaw_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>
</visual> 

<collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry name="${prefix}_ankle_yaw_collision">
        <mesh filename="package://pholus_urdf/meshes/simple/ankle_yaw_right.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>             
</collision>  
</link>

<link name="${prefix}_wheel">
<inertial>
	<mass value="${8.8916857e-01}"/>
	<origin xyz="0 ${6.4062682e+01*mmTom*mirror_link-65.35*mmTom*mirror_link} 0" rpy="0.0 0.0 0.0"/>      
	<inertia ixx="${3.0052417e+03*mm2Tom2}"  ixy="0"  ixz="0" iyy="${4.2199723e+03*mm2Tom2}" iyz="0" izz="${3.0052416e+03*mm2Tom2}" />
</inertial>

<visual>
      <origin xyz="0 ${-65.35*mmTom*mirror_link} 0" rpy="0 0 0"/>
      <material name="dark"/>
      <geometry name="${prefix}_wheel_visual">
        <mesh filename="package://pholus_urdf/meshes/wheel.stl" scale="${mmTom} ${mmTom*mirror_link} ${mmTom}"/>
      </geometry>
</visual> 

<collision>
      <origin xyz="0 0 0" rpy="${PI_2} 0 0"/>
      <geometry name="${prefix}_wheel_collision">
        <cylinder length="0.06" radius="${0.17/2.}"/>
      </geometry>             
</collision>  
</link>
</xacro:unless>

<!-- JOINTS -->
<joint name="${prefix}_hip_yaw_joint" type="revolute">
    <parent link="pelvis"/>
    <child link="${prefix}_hip_yaw"/>
    <axis xyz="0 0 -1"/>
    <limit velocity="8.84" effort="${314*torque_scale}" lower="${(-145-(1-mirror_link)*7)*toRad}" upper="${(159-(1-mirror_link)*7)*toRad}" /> 
    <dynamics friction="0" damping="0.03"/>
    <origin xyz="${x} ${y} ${z}" rpy="0 0 0" />
</joint>

<joint name="${prefix}_hip_pitch_joint" type="revolute">
    <parent link="${prefix}_hip_yaw"/>
    <child link="${prefix}_hip_pitch"/>
    <axis xyz="0 ${-1*mirror_link} 0"/>
    <limit velocity="6.63" effort="${314*torque_scale}" lower="${-150*toRad}" upper="${150*toRad}" /> 
    <dynamics friction="0" damping="0.03"/>
    <origin xyz="0 ${-114.6*mmTom*mirror_link} ${-62.5*mmTom}" rpy="0 0 0" />
</joint>



<xacro:if value="${USE_STICKS}">
<joint name="${prefix}_knee_joint" type="revolute">
    <parent link="${prefix}_hip_pitch"/>
    <child link="${prefix}_stick"/>
    <axis xyz="0 ${1*mirror_link} 0"/>
    <limit velocity="3.86" effort="${147*torque_scale}" lower="${-135*toRad}" upper="${135*toRad}" /> 
    <dynamics friction="0" damping="0.03"/>
    <origin xyz="0.0 ${118.2*mmTom*mirror_link} ${-310.132*mmTom}" rpy="0 0 0" />
</joint>
</xacro:if>

<xacro:unless value="${USE_STICKS}">
<joint name="${prefix}_knee_joint" type="revolute">
    <parent link="${prefix}_hip_pitch"/>
    <child link="${prefix}_knee"/>
    <axis xyz="0 ${1*mirror_link} 0"/>
    <limit velocity="6.63" effort="${314*torque_scale}" lower="${-139*toRad}" upper="${139*toRad}" /> 
    <dynamics friction="0" damping="0.03"/>
    <origin xyz="0.0 ${118.2*mmTom*mirror_link} ${-300.0*mmTom}" rpy="0 0 0" />
</joint>

<joint name="${prefix}_ankle_pitch_joint" type="revolute">
    <parent link="${prefix}_knee"/>
    <child link="${prefix}_ankle_pitch"/>
    <axis xyz="0 ${-1*mirror_link} 0"/>
    <limit velocity="3.86" effort="${147*torque_scale}" lower="${-135*toRad}" upper="${135*toRad}" /> 
    <dynamics friction="0" damping="0.03"/>
    <origin xyz="0.0 ${-100.15*mmTom*mirror_link} ${-189.868*mmTom}" rpy="0 0 0" />
</joint>

<joint name="${prefix}_ankle_yaw_joint" type="revolute">
    <parent link="${prefix}_ankle_pitch"/>
    <child link="${prefix}_ankle_yaw"/>
    <axis xyz="0 0 -1"/>
    <limit velocity="11.72" effort="${55*torque_scale}" lower="${-146*toRad}" upper="${146*toRad}" /> 
    <dynamics friction="0" damping="0.03"/>
    <origin xyz="0 ${-0.85*mmTom*mirror_link} ${-149*mmTom}" rpy="0 0 0" />
</joint>

<joint name="${prefix}_wheel_joint" type="continuous">
    <parent link="${prefix}_ankle_yaw"/>
    <child link="${prefix}_wheel"/>
    <axis xyz="0 ${1*mirror_link} 0"/>
    <limit velocity="20" effort="${35*torque_scale}"/> 
    <dynamics friction="0" damping="0.03"/>
    <!--origin xyz="0 ${-65.35*mmTom*mirror_link} ${-114.35*mmTom}" rpy="0 0 0" /-->
    <origin xyz="0 0 ${-114.35*mmTom}" rpy="0 0 0" />
</joint>
</xacro:unless>

</xacro:macro>

</robot>
